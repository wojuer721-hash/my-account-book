<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂèØÁà±ËÆ∞Ë¥¶Êú¨</title>
    <!-- ÂºïÂÖ•SheetJSÂ∫ìÁî®‰∫éÂØºÂá∫XLSX -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary: #FF8DC7;
            --secondary: #A3D8FF;
            --accent: #FFD59E;
            --light: #FFF5E4;
            --text: #5A5A5A;
            --success: #A8E6CF;
            --danger: #FFAAA5;
            --card-bg: rgba(255, 255, 255, 0.9);
            --shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }
        
        body {
            background: linear-gradient(135deg, #FFD6E7 0%, #C1E3FF 100%);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 20px;
            background: var(--card-bg);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        h1 i {
            color: var(--accent);
            font-size: 2.2rem;
        }
        
        .summary-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 2px dashed var(--secondary);
        }
        
        .summary-card::before {
            content: "";
            position: absolute;
            top: -50px;
            right: -50px;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--accent);
            opacity: 0.2;
        }
        
        .summary-card::after {
            content: "";
            position: absolute;
            bottom: -30px;
            left: -30px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary);
            opacity: 0.2;
        }
        
        .summary-card h2 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            opacity: 0.9;
            color: var(--primary);
        }
        
        .summary-card .amount {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            text-shadow: 2px 2px 0px rgba(255, 141, 199, 0.2);
        }
        
        .content {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
        }
        
        .form-section, .records-section {
            flex: 1;
            min-width: 300px;
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .form-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--secondary);
        }
        
        .records-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--accent);
        }
        
        .section-title {
            font-size: 1.4rem;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px dotted var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--accent);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        label i {
            color: var(--primary);
            width: 20px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #E8E8E8;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 141, 199, 0.2);
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #FF6BAE);
            color: white;
            box-shadow: 0 4px 10px rgba(255, 107, 174, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 107, 174, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #7ED9A3);
            color: white;
            box-shadow: 0 4px 10px rgba(168, 230, 207, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(168, 230, 207, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #FF8A80);
            color: white;
            box-shadow: 0 4px 10px rgba(255, 170, 165, 0.3);
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 170, 165, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #E8E8E8, #D0D0D0);
            color: var(--text);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .buttons .btn {
            flex: 1;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #F0F0F0;
        }
        
        th {
            background-color: rgba(163, 216, 255, 0.2);
            font-weight: 600;
            color: var(--primary);
        }
        
        tr:hover {
            background-color: rgba(255, 213, 158, 0.1);
        }
        
        .income {
            color: #2E8B57;
            font-weight: 500;
        }
        
        .expense {
            color: #FF6B6B;
            font-weight: 500;
        }
        
        .actions {
            display: flex;
            gap: 5px;
        }
        
        .actions .btn {
            padding: 8px 12px;
            font-size: 0.85rem;
            border-radius: 8px;
        }
        
        .project-management {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px dotted var(--secondary);
        }
        
        .project-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .project-item {
            background: white;
            border-radius: 15px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #F0F0F0;
        }
        
        .project-item.income {
            border-left: 4px solid var(--success);
        }
        
        .project-item.expense {
            border-left: 4px solid var(--danger);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            position: relative;
            border: 2px solid var(--primary);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.3rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close {
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text);
            transition: all 0.3s;
        }
        
        .close:hover {
            color: var(--primary);
            transform: scale(1.1);
        }
        
        .search-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 2px dashed var(--accent);
        }
        
        .search-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .search-group {
            flex: 1;
            min-width: 200px;
        }
        
        .search-results-info {
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--text);
            padding: 10px;
            background: rgba(255, 213, 158, 0.2);
            border-radius: 10px;
            text-align: center;
        }
        
        .record-count {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            margin: 0 5px;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .search-row {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
        
        .floating-elements {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }
        
        .floating-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.5rem;
            color: white;
        }
        
        .floating-btn.primary {
            background: var(--primary);
        }
        
        .floating-btn.success {
            background: var(--success);
        }
        
        .floating-btn:hover {
            transform: scale(1.1);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text);
        }
        
        .empty-state i {
            font-size: 4rem;
            color: var(--secondary);
            margin-bottom: 20px;
        }
        
        .empty-state p {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        .type-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .type-income {
            background: var(--success);
        }
        
        .type-expense {
            background: var(--danger);
        }
        
        .emoji {
            font-size: 1.2rem;
            margin-right: 5px;
        }
        
        /* ÂàÜÈ°µÊ†∑Âºè */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
        }
        
        .pagination-info {
            font-size: 0.9rem;
            color: var(--text);
        }
        
        .pagination-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .pagination-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            background: var(--secondary);
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-size-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .page-size-selector select {
            width: auto;
            padding: 8px 15px;
        }
        
        /* Â§öÈÄâ‰∏ãÊãâÊ°ÜÊ†∑Âºè */
        .multiselect-container {
            position: relative;
        }
        
        .multiselect-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: white;
            border: 2px solid #E8E8E8;
            border-radius: 12px;
            margin-top: 5px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .multiselect-dropdown.active {
            display: block;
        }
        
        .multiselect-search {
            padding: 10px;
            border-bottom: 1px solid #E8E8E8;
        }
        
        .multiselect-search input {
            padding: 8px 12px;
            border-radius: 8px;
        }
        
        .multiselect-options {
            max-height: 150px;
            overflow-y: auto;
        }
        
        .multiselect-option {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
        }
        
        .multiselect-option:hover {
            background: rgba(163, 216, 255, 0.2);
        }
        
        .multiselect-option.selected {
            background: rgba(255, 141, 199, 0.2);
        }
        
        .multiselect-selected {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }
        
        .selected-tag {
            background: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .selected-tag .remove {
            cursor: pointer;
            font-weight: bold;
        }
        
        .multiselect-input {
            cursor: pointer;
            position: relative;
        }
        
        .multiselect-input::after {
            content: "‚ñº";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text);
            pointer-events: none;
        }
        
        /* ÂØºÂÖ•ÂäüËÉΩÊ†∑Âºè */
        .import-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dotted var(--secondary);
        }
        
        .import-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .import-preview {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #E8E8E8;
            border-radius: 12px;
            padding: 15px;
            background: white;
        }
        
        .import-preview table {
            margin-top: 0;
            font-size: 0.9rem;
        }
        
        .import-preview th, .import-preview td {
            padding: 8px 12px;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-label {
            display: block;
            padding: 14px 18px;
            border: 2px dashed var(--secondary);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(163, 216, 255, 0.1);
        }
        
        .file-input-label:hover {
            background: rgba(163, 216, 255, 0.2);
            border-color: var(--primary);
        }
        
        .file-input-label i {
            color: var(--primary);
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-piggy-bank"></i> ÂèØÁà±ËÆ∞Ë¥¶Êú¨ <i class="fas fa-heart"></i></h1>
            <p>ËΩªÊùæËÆ∞ÂΩïÊØè‰∏ÄÁ¨îÊî∂ÊîØÔºåËÆ©Ë¥¢Âä°ÁÆ°ÁêÜÂèòÂæóÁÆÄÂçïÂèàÊúâË∂£</p>
        </header>
        
        <div class="summary-card">
            <h2><i class="fas fa-wallet"></i> ÂΩìÂâç‰ΩôÈ¢ù</h2>
            <div class="amount" id="totalAmount">¬•0.00</div>
        </div>
        
        <div class="content">
            <div class="form-section">
                <h2 class="section-title"><i class="fas fa-plus-circle"></i> Ê∑ªÂä†Êñ∞ËÆ∞ÂΩï</h2>
                <form id="accountForm">
                    <div class="form-group">
                        <label for="date"><i class="fas fa-calendar-alt"></i> Êó•Êúü</label>
                        <input type="date" id="date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="type"><i class="fas fa-exchange-alt"></i> Á±ªÂûã</label>
                        <select id="type" required>
                            <option value="income">Êî∂ÂÖ• üí∞</option>
                            <option value="expense">ÊîØÂá∫ üí∏</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="project"><i class="fas fa-tags"></i> È°πÁõÆ</label>
                        <select id="project" required>
                            <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="amount"><i class="fas fa-coins"></i> ÈáëÈ¢ù</label>
                        <input type="number" id="amount" step="0.01" min="0" placeholder="ËØ∑ËæìÂÖ•ÈáëÈ¢ù" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="note"><i class="fas fa-sticky-note"></i> Â§áÊ≥®</label>
                        <textarea id="note" rows="3" placeholder="Ê∑ªÂä†Â§áÊ≥®ÔºàÂèØÈÄâÔºâ"></textarea>
                    </div>
                    
                    <div class="buttons">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Ê∑ªÂä†ËÆ∞ÂΩï</button>
                        <button type="button" class="btn btn-secondary" id="resetBtn"><i class="fas fa-redo"></i> ÈáçÁΩÆ</button>
                    </div>
                </form>
                
                <div class="import-section">
                    <h3 class="section-title"><i class="fas fa-file-import"></i> ÂØºÂÖ•ËÆ∞ÂΩï</h3>
                    <div class="file-input-wrapper">
                        <input type="file" id="importFile" accept=".xlsx, .xls, .csv">
                        <label for="importFile" class="file-input-label">
                            <i class="fas fa-upload"></i> ÈÄâÊã©Excel/CSVÊñá‰ª∂ÂØºÂÖ•
                        </label>
                    </div>
                    <div class="import-actions">
                        <button class="btn btn-success" id="downloadTemplateBtn"><i class="fas fa-download"></i> ‰∏ãËΩΩÊ®°Êùø</button>
                        <button class="btn btn-primary" id="importBtn" disabled><i class="fas fa-file-import"></i> ÂØºÂÖ•Êï∞ÊçÆ</button>
                    </div>
                    <div class="import-preview" id="importPreview" style="display: none;">
                        <h4>ÂØºÂÖ•È¢ÑËßà (Ââç5Êù°ËÆ∞ÂΩï)</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Êó•Êúü</th>
                                    <th>Á±ªÂûã</th>
                                    <th>È°πÁõÆ</th>
                                    <th>ÈáëÈ¢ù</th>
                                    <th>Â§áÊ≥®</th>
                                </tr>
                            </thead>
                            <tbody id="importPreviewBody">
                                <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="project-management">
                    <h3 class="section-title"><i class="fas fa-cog"></i> È°πÁõÆÁÆ°ÁêÜ</h3>
                    <button class="btn btn-success" id="addProjectBtn"><i class="fas fa-plus"></i> Ê∑ªÂä†È°πÁõÆ</button>
                    
                    <div class="project-list" id="projectList">
                        <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                    </div>
                </div>
            </div>
            
            <div class="records-section">
                <h2 class="section-title"><i class="fas fa-list-alt"></i> Ë¥¶Êú¨ËÆ∞ÂΩï</h2>
                
                <div class="search-section">
                    <h3><i class="fas fa-search"></i> Êü•ËØ¢ËÆ∞ÂΩï</h3>
                    <div class="search-row">
                        <div class="search-group">
                            <label for="startDate"><i class="fas fa-calendar"></i> ÂºÄÂßãÊó•Êúü</label>
                            <input type="date" id="startDate">
                        </div>
                        <div class="search-group">
                            <label for="endDate"><i class="fas fa-calendar"></i> ÁªìÊùüÊó•Êúü</label>
                            <input type="date" id="endDate">
                        </div>
                        <div class="search-group">
                            <label for="searchProject"><i class="fas fa-filter"></i> È°πÁõÆÁ≠õÈÄâ</label>
                            <div class="multiselect-container">
                                <div class="multiselect-input" id="multiselectInput">
                                    ÈÄâÊã©È°πÁõÆ...
                                </div>
                                <div class="multiselect-dropdown" id="multiselectDropdown">
                                    <div class="multiselect-search">
                                        <input type="text" id="multiselectSearch" placeholder="ÊêúÁ¥¢È°πÁõÆ...">
                                    </div>
                                    <div class="multiselect-options" id="multiselectOptions">
                                        <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                                    </div>
                                </div>
                                <div class="multiselect-selected" id="multiselectSelected">
                                    <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="buttons">
                        <button class="btn btn-primary" id="searchBtn"><i class="fas fa-search"></i> Êü•ËØ¢</button>
                        <button class="btn btn-secondary" id="resetSearchBtn"><i class="fas fa-times"></i> ÈáçÁΩÆÊü•ËØ¢</button>
                    </div>
                    <div class="search-results-info" id="searchResultsInfo">
                        ÊòæÁ§∫ÂÖ®ÈÉ®ËÆ∞ÂΩï
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-success" id="exportBtn"><i class="fas fa-file-export"></i> ÂØºÂá∫Êï∞ÊçÆ(XLSX)</button>
                    <button class="btn btn-danger" id="clearBtn"><i class="fas fa-trash"></i> Ê∏ÖÁ©∫ËÆ∞ÂΩï</button>
                </div>
                
                <table id="recordsTable">
                    <thead>
                        <tr>
                            <th>Êó•Êúü</th>
                            <th>Á±ªÂûã</th>
                            <th>È°πÁõÆ</th>
                            <th>ÈáëÈ¢ù</th>
                            <th>Â§áÊ≥®</th>
                            <th>Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                    </tbody>
                </table>
                
                <!-- ÂàÜÈ°µÊéß‰ª∂ -->
                <div class="pagination">
                    <div class="pagination-info" id="paginationInfo">
                        Á¨¨ 1 È°µÔºåÂÖ± 1 È°µÔºåÊØèÈ°µ 10 Êù°ËÆ∞ÂΩï
                    </div>
                    <div class="pagination-controls">
                        <div class="page-size-selector">
                            <span>ÊØèÈ°µÊòæÁ§∫:</span>
                            <select id="pageSize">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                                <option value="200">200</option>
                            </select>
                        </div>
                        <button class="pagination-btn" id="firstPageBtn" disabled>È¶ñÈ°µ</button>
                        <button class="pagination-btn" id="prevPageBtn" disabled>‰∏ä‰∏ÄÈ°µ</button>
                        <span id="currentPageIndicator">1</span>
                        <button class="pagination-btn" id="nextPageBtn" disabled>‰∏ã‰∏ÄÈ°µ</button>
                        <button class="pagination-btn" id="lastPageBtn" disabled>Êú´È°µ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- È°πÁõÆÁºñËæëÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-edit"></i> Ê∑ªÂä†/ÁºñËæëÈ°πÁõÆ</h3>
                <span class="close">&times;</span>
            </div>
            <form id="projectForm">
                <div class="form-group">
                    <label for="projectName"><i class="fas fa-tag"></i> È°πÁõÆÂêçÁß∞</label>
                    <input type="text" id="projectName" required>
                </div>
                
                <div class="form-group">
                    <label for="projectType"><i class="fas fa-exchange-alt"></i> È°πÁõÆÁ±ªÂûã</label>
                    <select id="projectType" required>
                        <option value="income">Êî∂ÂÖ•È°πÁõÆ üí∞</option>
                        <option value="expense">ÊîØÂá∫È°πÁõÆ üí∏</option>
                    </select>
                </div>
                
                <div class="buttons">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> ‰øùÂ≠ò</button>
                    <button type="button" class="btn btn-secondary" id="cancelProjectBtn"><i class="fas fa-times"></i> ÂèñÊ∂à</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ÊµÆÂä®ÊåâÈíÆ -->
    <div class="floating-elements">
        <div class="floating-btn primary" id="quickAddBtn" title="Âø´ÈÄüÊ∑ªÂä†ËÆ∞ÂΩï">
            <i class="fas fa-plus"></i>
        </div>
        <div class="floating-btn success" id="quickExportBtn" title="Âø´ÈÄüÂØºÂá∫">
            <i class="fas fa-file-export"></i>
        </div>
    </div>

    <script>
        // ÂàùÂßãÂåñÈªòËÆ§È°πÁõÆÂíåË¥¶Êú¨Êï∞ÊçÆ
        let projects = [
            { id: 1, name: "Â∑•ËµÑ", type: "income", emoji: "üí∞" },
            { id: 2, name: "ÂÖ∂‰ªñ", type: "income", emoji: "üíº" },
            { id: 3, name: "È•ÆÈ£ü", type: "expense", emoji: "üçî" },
            { id: 4, name: "Ë°£Êúç", type: "expense", emoji: "üëï" },
            { id: 5, name: "Êó•Áî®ÂìÅ", type: "expense", emoji: "üß¥" },
            { id: 6, name: "ÂåñÂ¶ÜÂìÅ", type: "expense", emoji: "üíÑ" },
            { id: 7, name: "ÂÆ†Áâ©", type: "expense", emoji: "üê∂" },
            { id: 8, name: "ÊóÖÊ∏∏", type: "expense", emoji: "‚úàÔ∏è" },
            { id: 9, name: "ÁîµÂä®ËΩ¶", type: "expense", emoji: "üõµ" }
        ];

        let records = [];
        let editingProjectId = null;
        let currentFilter = {
            startDate: null,
            endDate: null,
            projects: []
        };
        
        // ÂàÜÈ°µÁõ∏ÂÖ≥ÂèòÈáè
        let currentPage = 1;
        let pageSize = 10;
        let totalPages = 1;
        
        // ÂØºÂÖ•Áõ∏ÂÖ≥ÂèòÈáè
        let importData = [];

        // DOM ÂÖÉÁ¥†
        const accountForm = document.getElementById('accountForm');
        const projectForm = document.getElementById('projectForm');
        const projectSelect = document.getElementById('project');
        const projectList = document.getElementById('projectList');
        const recordsTable = document.getElementById('recordsTable').getElementsByTagName('tbody')[0];
        const totalAmountElement = document.getElementById('totalAmount');
        const projectModal = document.getElementById('projectModal');
        const addProjectBtn = document.getElementById('addProjectBtn');
        const exportBtn = document.getElementById('exportBtn');
        const clearBtn = document.getElementById('clearBtn');
        const resetBtn = document.getElementById('resetBtn');
        const cancelProjectBtn = document.getElementById('cancelProjectBtn');
        const closeModalBtn = document.querySelector('.close');
        const searchBtn = document.getElementById('searchBtn');
        const resetSearchBtn = document.getElementById('resetSearchBtn');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const searchResultsInfo = document.getElementById('searchResultsInfo');
        const quickAddBtn = document.getElementById('quickAddBtn');
        const quickExportBtn = document.getElementById('quickExportBtn');
        
        // ÂàÜÈ°µÁõ∏ÂÖ≥DOMÂÖÉÁ¥†
        const pageSizeSelect = document.getElementById('pageSize');
        const firstPageBtn = document.getElementById('firstPageBtn');
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');
        const lastPageBtn = document.getElementById('lastPageBtn');
        const currentPageIndicator = document.getElementById('currentPageIndicator');
        const paginationInfo = document.getElementById('paginationInfo');
        
        // Â§öÈÄâ‰∏ãÊãâÊ°ÜÁõ∏ÂÖ≥DOMÂÖÉÁ¥†
        const multiselectInput = document.getElementById('multiselectInput');
        const multiselectDropdown = document.getElementById('multiselectDropdown');
        const multiselectSearch = document.getElementById('multiselectSearch');
        const multiselectOptions = document.getElementById('multiselectOptions');
        const multiselectSelected = document.getElementById('multiselectSelected');
        
        // ÂØºÂÖ•Áõ∏ÂÖ≥DOMÂÖÉÁ¥†
        const importFileInput = document.getElementById('importFile');
        const downloadTemplateBtn = document.getElementById('downloadTemplateBtn');
        const importBtn = document.getElementById('importBtn');
        const importPreview = document.getElementById('importPreview');
        const importPreviewBody = document.getElementById('importPreviewBody');

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ËÆæÁΩÆÈªòËÆ§Êó•Êúü‰∏∫‰ªäÂ§©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            
            // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÊï∞ÊçÆ
            loadData();
            
            // Êõ¥Êñ∞È°πÁõÆÈÄâÊã©ÂàóË°®
            updateProjectSelect();
            
            // Êõ¥Êñ∞È°πÁõÆÊòæÁ§∫ÂàóË°®
            updateProjectList();
            
            // Êõ¥Êñ∞Êü•ËØ¢È°πÁõÆÈÄâÊã©ÂàóË°®
            updateMultiselectOptions();
            
            // Êõ¥Êñ∞ËÆ∞ÂΩïË°®Ê†º
            updateRecordsTable();
            
            // Êõ¥Êñ∞ÊÄªÈáëÈ¢ù
            updateTotalAmount();
            
            // Êõ¥Êñ∞ÂàÜÈ°µ‰ø°ÊÅØ
            updatePaginationInfo();
            
            // ‰∫ã‰ª∂ÁõëÂê¨Âô®
            accountForm.addEventListener('submit', addRecord);
            projectForm.addEventListener('submit', saveProject);
            addProjectBtn.addEventListener('click', openProjectModal);
            exportBtn.addEventListener('click', exportData);
            clearBtn.addEventListener('click', clearRecords);
            resetBtn.addEventListener('click', resetForm);
            cancelProjectBtn.addEventListener('click', closeProjectModal);
            closeModalBtn.addEventListener('click', closeProjectModal);
            searchBtn.addEventListener('click', applyFilter);
            resetSearchBtn.addEventListener('click', resetFilter);
            quickAddBtn.addEventListener('click', scrollToForm);
            quickExportBtn.addEventListener('click', exportData);
            
            // ÂàÜÈ°µ‰∫ã‰ª∂ÁõëÂê¨Âô®
            pageSizeSelect.addEventListener('change', changePageSize);
            firstPageBtn.addEventListener('click', () => changePage(1));
            prevPageBtn.addEventListener('click', goToPrevPage);
            nextPageBtn.addEventListener('click', goToNextPage);
            lastPageBtn.addEventListener('click', goToLastPage);
            
            // Â§öÈÄâ‰∏ãÊãâÊ°Ü‰∫ã‰ª∂ÁõëÂê¨Âô®
            multiselectInput.addEventListener('click', toggleMultiselectDropdown);
            multiselectSearch.addEventListener('input', filterMultiselectOptions);
            
            // ÂØºÂÖ•‰∫ã‰ª∂ÁõëÂê¨Âô®
            importFileInput.addEventListener('change', handleFileSelect);
            downloadTemplateBtn.addEventListener('click', downloadTemplate);
            importBtn.addEventListener('click', importRecords);
            
            // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
            window.addEventListener('click', function(event) {
                if (event.target === projectModal) {
                    closeProjectModal();
                }
                if (!multiselectInput.contains(event.target) && !multiselectDropdown.contains(event.target)) {
                    multiselectDropdown.classList.remove('active');
                }
            });
        });

        // ÊªöÂä®Âà∞Ë°®ÂçïÂå∫Âüü
        function scrollToForm() {
            document.querySelector('.form-section').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        // Âä†ËΩΩÊú¨Âú∞Â≠òÂÇ®ÁöÑÊï∞ÊçÆ
        function loadData() {
            const savedProjects = localStorage.getItem('accountProjects');
            const savedRecords = localStorage.getItem('accountRecords');
            
            if (savedProjects) {
                projects = JSON.parse(savedProjects);
            }
            
            if (savedRecords) {
                records = JSON.parse(savedRecords);
            }
        }

        // ‰øùÂ≠òÊï∞ÊçÆÂà∞Êú¨Âú∞Â≠òÂÇ®
        function saveData() {
            localStorage.setItem('accountProjects', JSON.stringify(projects));
            localStorage.setItem('accountRecords', JSON.stringify(records));
        }

        // Êõ¥Êñ∞È°πÁõÆÈÄâÊã©‰∏ãÊãâÂàóË°®
        function updateProjectSelect() {
            const type = document.getElementById('type').value;
            projectSelect.innerHTML = '';
            
            const filteredProjects = projects.filter(project => project.type === type);
            
            filteredProjects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = `${project.emoji || 'üìÅ'} ${project.name}`;
                projectSelect.appendChild(option);
            });
        }

        // Êõ¥Êñ∞Â§öÈÄâ‰∏ãÊãâÊ°ÜÈÄâÈ°π
        function updateMultiselectOptions() {
            multiselectOptions.innerHTML = '';
            
            projects.forEach(project => {
                const option = document.createElement('div');
                option.className = 'multiselect-option';
                option.dataset.id = project.id;
                option.innerHTML = `
                    <span class="emoji">${project.emoji || 'üìÅ'}</span>
                    <span>${project.name}</span>
                    <span style="margin-left: auto; font-size: 0.8rem; color: #999;">${project.type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫'}</span>
                `;
                
                option.addEventListener('click', () => toggleProjectSelection(project.id));
                
                // Â¶ÇÊûúÈ°πÁõÆÂ∑≤Ë¢´ÈÄâ‰∏≠ÔºåÊ∑ªÂä†ÈÄâ‰∏≠Ê†∑Âºè
                if (currentFilter.projects.includes(project.id)) {
                    option.classList.add('selected');
                }
                
                multiselectOptions.appendChild(option);
            });
            
            updateMultiselectSelected();
        }

        // ÂàáÊç¢È°πÁõÆÈÄâÊã©Áä∂ÊÄÅ
        function toggleProjectSelection(projectId) {
            const index = currentFilter.projects.indexOf(projectId);
            
            if (index === -1) {
                // Ê∑ªÂä†È°πÁõÆ
                currentFilter.projects.push(projectId);
            } else {
                // ÁßªÈô§È°πÁõÆ
                currentFilter.projects.splice(index, 1);
            }
            
            // Êõ¥Êñ∞UI
            updateMultiselectOptions();
        }

        // Êõ¥Êñ∞Â∑≤ÈÄâÈ°πÁõÆÊòæÁ§∫
        function updateMultiselectSelected() {
            multiselectSelected.innerHTML = '';
            
            if (currentFilter.projects.length === 0) {
                multiselectInput.textContent = 'ÈÄâÊã©È°πÁõÆ...';
                return;
            }
            
            multiselectInput.textContent = `Â∑≤ÈÄâÊã© ${currentFilter.projects.length} ‰∏™È°πÁõÆ`;
            
            currentFilter.projects.forEach(projectId => {
                const project = projects.find(p => p.id === projectId);
                if (project) {
                    const tag = document.createElement('div');
                    tag.className = 'selected-tag';
                    tag.innerHTML = `
                        <span class="emoji">${project.emoji || 'üìÅ'}</span>
                        <span>${project.name}</span>
                        <span class="remove" data-id="${project.id}">√ó</span>
                    `;
                    
                    tag.querySelector('.remove').addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleProjectSelection(project.id);
                    });
                    
                    multiselectSelected.appendChild(tag);
                }
            });
        }

        // ÂàáÊç¢Â§öÈÄâ‰∏ãÊãâÊ°ÜÊòæÁ§∫Áä∂ÊÄÅ
        function toggleMultiselectDropdown() {
            multiselectDropdown.classList.toggle('active');
            if (multiselectDropdown.classList.contains('active')) {
                multiselectSearch.focus();
            }
        }

        // ËøáÊª§Â§öÈÄâ‰∏ãÊãâÊ°ÜÈÄâÈ°π
        function filterMultiselectOptions() {
            const searchTerm = multiselectSearch.value.toLowerCase();
            const options = multiselectOptions.querySelectorAll('.multiselect-option');
            
            options.forEach(option => {
                const text = option.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    option.style.display = 'flex';
                } else {
                    option.style.display = 'none';
                }
            });
        }

        // Êõ¥Êñ∞È°πÁõÆÊòæÁ§∫ÂàóË°®
        function updateProjectList() {
            projectList.innerHTML = '';
            
            if (projects.length === 0) {
                projectList.innerHTML = '<div class="empty-state"><p>ÊöÇÊó†È°πÁõÆÔºåËØ∑Ê∑ªÂä†</p></div>';
                return;
            }
            
            projects.forEach(project => {
                const projectItem = document.createElement('div');
                projectItem.className = `project-item ${project.type}`;
                projectItem.innerHTML = `
                    <span class="emoji">${project.emoji || 'üìÅ'}</span>
                    <span>${project.name}</span>
                    <div class="actions">
                        <button class="btn btn-secondary edit-project" data-id="${project.id}"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger delete-project" data-id="${project.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                projectList.appendChild(projectItem);
            });
            
            // Ê∑ªÂä†ÁºñËæëÂíåÂà†Èô§È°πÁõÆÁöÑ‰∫ã‰ª∂ÁõëÂê¨
            document.querySelectorAll('.edit-project').forEach(button => {
                button.addEventListener('click', function() {
                    const projectId = parseInt(this.getAttribute('data-id'));
                    editProject(projectId);
                });
            });
            
            document.querySelectorAll('.delete-project').forEach(button => {
                button.addEventListener('click', function() {
                    const projectId = parseInt(this.getAttribute('data-id'));
                    deleteProject(projectId);
                });
            });
        }

        // Ê∑ªÂä†Êñ∞ËÆ∞ÂΩï
        function addRecord(e) {
            e.preventDefault();
            
            const date = document.getElementById('date').value;
            const type = document.getElementById('type').value;
            const projectId = parseInt(document.getElementById('project').value);
            let amount = parseFloat(document.getElementById('amount').value);
            const note = document.getElementById('note').value;
            
            // Â¶ÇÊûúÊòØÊîØÂá∫ÔºåÈáëÈ¢ùËΩ¨‰∏∫Ë¥üÊï∞
            if (type === 'expense') {
                amount = -Math.abs(amount);
            }
            
            // Ëé∑ÂèñÈ°πÁõÆÂêçÁß∞
            const project = projects.find(p => p.id === projectId);
            const projectName = project ? project.name : 'Êú™Áü•';
            const projectEmoji = project ? project.emoji : 'üìÅ';
            
            // ÂàõÂª∫Êñ∞ËÆ∞ÂΩï
            const newRecord = {
                id: Date.now(),
                date,
                type,
                projectId,
                projectName,
                projectEmoji,
                amount,
                note
            };
            
            records.push(newRecord);
            saveData();
            updateRecordsTable();
            updateTotalAmount();
            resetForm();
            
            // ÊòæÁ§∫ÊàêÂäüÊèêÁ§∫
            showNotification(`ÊàêÂäüÊ∑ªÂä†${type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫'}ËÆ∞ÂΩïÔºÅ`, 'success');
        }

        // ÊòæÁ§∫ÈÄöÁü•
        function showNotification(message, type) {
            // ÂàõÂª∫ÈÄöÁü•ÂÖÉÁ¥†
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: ${type === 'success' ? 'var(--success)' : 'var(--danger)'}; color: white; padding: 15px 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 1000; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // 3ÁßíÂêéÁßªÈô§ÈÄöÁü•
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Êõ¥Êñ∞ËÆ∞ÂΩïË°®Ê†º
        function updateRecordsTable() {
            recordsTable.innerHTML = '';
            
            // Â∫îÁî®Á≠õÈÄâÊù°‰ª∂
            let filteredRecords = applyFilterToRecords(records);
            
            // ËÆ°ÁÆóÂàÜÈ°µ
            totalPages = Math.ceil(filteredRecords.length / pageSize);
            if (currentPage > totalPages) {
                currentPage = totalPages || 1;
            }
            
            // Ëé∑ÂèñÂΩìÂâçÈ°µÁöÑËÆ∞ÂΩï
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const currentPageRecords = filteredRecords.slice(startIndex, endIndex);
            
            if (currentPageRecords.length === 0) {
                const emptyState = document.createElement('tr');
                emptyState.innerHTML = `
                    <td colspan="6">
                        <div class="empty-state">
                            <i class="fas fa-receipt"></i>
                            <p>ÊöÇÊó†ËÆ∞ÂΩï</p>
                            <p>ÁÇπÂáª"Ê∑ªÂä†ËÆ∞ÂΩï"ÂºÄÂßãËÆ∞Ë¥¶ÂêßÔºÅ</p>
                        </div>
                    </td>
                `;
                recordsTable.appendChild(emptyState);
                return;
            }
            
            // ÊåâÊó•ÊúüÊéíÂ∫èÔºåÊúÄÊñ∞ÁöÑÂú®ÂâçÈù¢
            currentPageRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            currentPageRecords.forEach(record => {
                const row = recordsTable.insertRow();
                
                // Êó•Êúü
                const dateCell = row.insertCell(0);
                dateCell.textContent = record.date;
                
                // Á±ªÂûã
                const typeCell = row.insertCell(1);
                typeCell.innerHTML = `
                    <span class="type-indicator ${record.type === 'income' ? 'type-income' : 'type-expense'}"></span>
                    ${record.type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫'}
                `;
                
                // È°πÁõÆ
                const projectCell = row.insertCell(2);
                projectCell.innerHTML = `<span class="emoji">${record.projectEmoji || 'üìÅ'}</span> ${record.projectName}`;
                
                // ÈáëÈ¢ù
                const amountCell = row.insertCell(3);
                amountCell.textContent = `¬•${Math.abs(record.amount).toFixed(2)}`;
                amountCell.className = record.type === 'income' ? 'income' : 'expense';
                
                // Â§áÊ≥®
                const noteCell = row.insertCell(4);
                noteCell.textContent = record.note || '-';
                
                // Êìç‰Ωú
                const actionCell = row.insertCell(5);
                actionCell.innerHTML = `<button class="btn btn-danger delete-record" data-id="${record.id}"><i class="fas fa-trash"></i></button>`;
            });
            
            // Ê∑ªÂä†Âà†Èô§ËÆ∞ÂΩïÁöÑ‰∫ã‰ª∂ÁõëÂê¨
            document.querySelectorAll('.delete-record').forEach(button => {
                button.addEventListener('click', function() {
                    const recordId = parseInt(this.getAttribute('data-id'));
                    deleteRecord(recordId);
                });
            });
            
            // Êõ¥Êñ∞ÊêúÁ¥¢ÁªìÊûú‰ø°ÊÅØ
            updateSearchResultsInfo(filteredRecords.length);
            
            // Êõ¥Êñ∞ÂàÜÈ°µ‰ø°ÊÅØ
            updatePaginationInfo();
        }

        // Â∫îÁî®Á≠õÈÄâÊù°‰ª∂Âà∞ËÆ∞ÂΩï
        function applyFilterToRecords(records) {
            let filtered = [...records];
            
            // Êó•ÊúüÁ≠õÈÄâ
            if (currentFilter.startDate) {
                filtered = filtered.filter(record => record.date >= currentFilter.startDate);
            }
            
            if (currentFilter.endDate) {
                filtered = filtered.filter(record => record.date <= currentFilter.endDate);
            }
            
            // È°πÁõÆÁ≠õÈÄâ
            if (currentFilter.projects.length > 0) {
                filtered = filtered.filter(record => currentFilter.projects.includes(record.projectId));
            }
            
            return filtered;
        }

        // Êõ¥Êñ∞ÊêúÁ¥¢ÁªìÊûú‰ø°ÊÅØ
        function updateSearchResultsInfo(count) {
            let infoText = `ÊòæÁ§∫ <span class="record-count">${count}</span> Êù°ËÆ∞ÂΩï`;
            
            if (currentFilter.startDate || currentFilter.endDate || currentFilter.projects.length > 0) {
                infoText += "ÔºàÂ∑≤Â∫îÁî®Á≠õÈÄâÊù°‰ª∂Ôºâ";
            } else {
                infoText += "ÔºàÂÖ®ÈÉ®ËÆ∞ÂΩïÔºâ";
            }
            
            searchResultsInfo.innerHTML = infoText;
        }

        // Âà†Èô§ËÆ∞ÂΩï
        function deleteRecord(recordId) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ËÆ∞ÂΩïÂêóÔºü')) {
                records = records.filter(record => record.id !== recordId);
                saveData();
                updateRecordsTable();
                updateTotalAmount();
                showNotification('ËÆ∞ÂΩïÂ∑≤Âà†Èô§ÔºÅ', 'success');
            }
        }

        // Êõ¥Êñ∞ÊÄªÈáëÈ¢ù
        function updateTotalAmount() {
            const total = records.reduce((sum, record) => sum + record.amount, 0);
            totalAmountElement.textContent = `¬•${total.toFixed(2)}`;
            
            // Ê†πÊçÆÊÄªÈáëÈ¢ùËÆæÁΩÆÈ¢úËâ≤
            if (total >= 0) {
                totalAmountElement.style.color = '#2E8B57';
            } else {
                totalAmountElement.style.color = '#FF6B6B';
            }
        }

        // ÈáçÁΩÆË°®Âçï
        function resetForm() {
            accountForm.reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            updateProjectSelect();
        }

        // ÊâìÂºÄÈ°πÁõÆÊ®°ÊÄÅÊ°Ü
        function openProjectModal() {
            editingProjectId = null;
            document.getElementById('projectName').value = '';
            document.getElementById('projectType').value = 'income';
            projectModal.style.display = 'flex';
        }

        // ÂÖ≥Èó≠È°πÁõÆÊ®°ÊÄÅÊ°Ü
        function closeProjectModal() {
            projectModal.style.display = 'none';
        }

        // ÁºñËæëÈ°πÁõÆ
        function editProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (project) {
                editingProjectId = projectId;
                document.getElementById('projectName').value = project.name;
                document.getElementById('projectType').value = project.type;
                projectModal.style.display = 'flex';
            }
        }

        // ‰øùÂ≠òÈ°πÁõÆ
        function saveProject(e) {
            e.preventDefault();
            
            const name = document.getElementById('projectName').value.trim();
            const type = document.getElementById('projectType').value;
            
            if (!name) {
                alert('ËØ∑ËæìÂÖ•È°πÁõÆÂêçÁß∞');
                return;
            }
            
            // Ê£ÄÊü•È°πÁõÆÂêçÁß∞ÊòØÂê¶Â∑≤Â≠òÂú®ÔºàÊéíÈô§ÂΩìÂâçÁºñËæëÁöÑÈ°πÁõÆÔºâ
            const existingProject = projects.find(p => 
                p.name.toLowerCase() === name.toLowerCase() && 
                p.id !== editingProjectId
            );
            
            if (existingProject) {
                alert('È°πÁõÆÂêçÁß∞Â∑≤Â≠òÂú®');
                return;
            }
            
            if (editingProjectId) {
                // Êõ¥Êñ∞Áé∞ÊúâÈ°πÁõÆ
                const projectIndex = projects.findIndex(p => p.id === editingProjectId);
                if (projectIndex !== -1) {
                    projects[projectIndex].name = name;
                    projects[projectIndex].type = type;
                }
                showNotification('È°πÁõÆÂ∑≤Êõ¥Êñ∞ÔºÅ', 'success');
            } else {
                // Ê∑ªÂä†Êñ∞È°πÁõÆ
                const newId = projects.length > 0 ? Math.max(...projects.map(p => p.id)) + 1 : 1;
                projects.push({
                    id: newId,
                    name,
                    type,
                    emoji: type === 'income' ? 'üí∞' : 'üí∏'
                });
                showNotification('È°πÁõÆÂ∑≤Ê∑ªÂä†ÔºÅ', 'success');
            }
            
            saveData();
            updateProjectSelect();
            updateProjectList();
            updateMultiselectOptions();
            closeProjectModal();
        }

        // Âà†Èô§È°πÁõÆ
        function deleteProject(projectId) {
            // Ê£ÄÊü•ÊòØÂê¶ÊúâËÆ∞ÂΩï‰ΩøÁî®Ê≠§È°πÁõÆ
            const recordsUsingProject = records.filter(record => record.projectId === projectId);
            
            if (recordsUsingProject.length > 0) {
                alert('Êó†Ê≥ïÂà†Èô§ËØ•È°πÁõÆÔºåÂõ†‰∏∫ÊúâËÆ∞ÂΩïÊ≠£Âú®‰ΩøÁî®ÂÆÉ„ÄÇËØ∑ÂÖàÂà†Èô§Áõ∏ÂÖ≥ËÆ∞ÂΩï„ÄÇ');
                return;
            }
            
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™È°πÁõÆÂêóÔºü')) {
                projects = projects.filter(project => project.id !== projectId);
                saveData();
                updateProjectSelect();
                updateProjectList();
                updateMultiselectOptions();
                showNotification('È°πÁõÆÂ∑≤Âà†Èô§ÔºÅ', 'success');
            }
        }

        // Â∫îÁî®Á≠õÈÄâÊù°‰ª∂
        function applyFilter() {
            currentFilter.startDate = startDateInput.value;
            currentFilter.endDate = endDateInput.value;
            
            // ÈáçÁΩÆÂà∞Á¨¨‰∏ÄÈ°µ
            currentPage = 1;
            
            updateRecordsTable();
        }

        // ÈáçÁΩÆÁ≠õÈÄâÊù°‰ª∂
        function resetFilter() {
            startDateInput.value = '';
            endDateInput.value = '';
            currentFilter = {
                startDate: null,
                endDate: null,
                projects: []
            };
            
            // ÈáçÁΩÆÂà∞Á¨¨‰∏ÄÈ°µ
            currentPage = 1;
            
            updateMultiselectOptions();
            updateRecordsTable();
        }

        // ÂØºÂá∫Êï∞ÊçÆ‰∏∫XLSXÊ†ºÂºè
        function exportData() {
            if (records.length === 0) {
                alert('Ê≤°ÊúâÊï∞ÊçÆÂèØÂØºÂá∫');
                return;
            }
            
            // Â∫îÁî®Á≠õÈÄâÊù°‰ª∂
            let dataToExport = applyFilterToRecords(records);
            
            // ÂáÜÂ§áÂØºÂá∫Êï∞ÊçÆ
            const exportData = [
                ['Êó•Êúü', 'Á±ªÂûã', 'È°πÁõÆ', 'ÈáëÈ¢ù', 'Â§áÊ≥®']
            ];
            
            dataToExport.forEach(record => {
                const typeText = record.type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫';
                const amountText = record.type === 'income' ? 
                    `+${record.amount.toFixed(2)}` : 
                    `-${Math.abs(record.amount).toFixed(2)}`;
                
                exportData.push([
                    record.date,
                    typeText,
                    record.projectName,
                    amountText,
                    record.note || ''
                ]);
            });
            
            // ÂàõÂª∫Â∑•‰ΩúÁ∞ø
            const ws = XLSX.utils.aoa_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Ë¥¶Êú¨ËÆ∞ÂΩï");
            
            // ÁîüÊàêÊñá‰ª∂Âêç
            const today = new Date().toISOString().split('T')[0];
            const fileName = `Ë¥¶Êú¨ËÆ∞ÂΩï_${today}.xlsx`;
            
            // ÂØºÂá∫Êñá‰ª∂
            XLSX.writeFile(wb, fileName);
            
            showNotification('Êï∞ÊçÆÂØºÂá∫ÊàêÂäüÔºÅ', 'success');
        }

        // Ê∏ÖÁ©∫ËÆ∞ÂΩï
        function clearRecords() {
            if (records.length === 0) {
                alert('Ê≤°ÊúâËÆ∞ÂΩïÂèØÊ∏ÖÁ©∫');
                return;
            }
            
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâËÆ∞ÂΩïÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ')) {
                records = [];
                saveData();
                updateRecordsTable();
                updateTotalAmount();
                showNotification('ÊâÄÊúâËÆ∞ÂΩïÂ∑≤Ê∏ÖÁ©∫ÔºÅ', 'success');
            }
        }

        // ÂàÜÈ°µÁõ∏ÂÖ≥ÂáΩÊï∞
        function changePageSize() {
            pageSize = parseInt(pageSizeSelect.value);
            currentPage = 1;
            updateRecordsTable();
        }
        
        function changePage(page) {
            currentPage = page;
            updateRecordsTable();
        }
        
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                updateRecordsTable();
            }
        }
        
        function goToNextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                updateRecordsTable();
            }
        }
        
        function goToLastPage() {
            currentPage = totalPages;
            updateRecordsTable();
        }
        
        function updatePaginationInfo() {
            const filteredRecords = applyFilterToRecords(records);
            const totalRecords = filteredRecords.length;
            const startRecord = (currentPage - 1) * pageSize + 1;
            const endRecord = Math.min(currentPage * pageSize, totalRecords);
            
            paginationInfo.innerHTML = `Á¨¨ ${currentPage} È°µÔºåÂÖ± ${totalPages} È°µÔºåÊØèÈ°µ ${pageSize} Êù°ËÆ∞ÂΩï`;
            currentPageIndicator.textContent = currentPage;
            
            // Êõ¥Êñ∞ÂàÜÈ°µÊåâÈíÆÁä∂ÊÄÅ
            firstPageBtn.disabled = currentPage === 1;
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
            lastPageBtn.disabled = currentPage === totalPages || totalPages === 0;
        }

        // ÂØºÂÖ•Áõ∏ÂÖ≥ÂáΩÊï∞
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™Â∑•‰ΩúË°®
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    // È™åËØÅÊï∞ÊçÆÊ†ºÂºè
                    if (jsonData.length < 2 || jsonData[0].join(',') !== 'Êó•Êúü,Á±ªÂûã,È°πÁõÆ,ÈáëÈ¢ù,Â§áÊ≥®') {
                        alert('Êñá‰ª∂Ê†ºÂºè‰∏çÊ≠£Á°ÆÔºåËØ∑‰ΩøÁî®‰∏ãËΩΩÁöÑÊ®°ÊùøÊñá‰ª∂ÔºÅ');
                        return;
                    }
                    
                    // Ëß£ÊûêÊï∞ÊçÆ
                    importData = [];
                    let hasError = false;
                    
                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row.length < 4) continue;
                        
                        const date = row[0];
                        const type = row[1];
                        const projectName = row[2];
                        const amount = parseFloat(row[3]);
                        const note = row[4] || '';
                        
                        // È™åËØÅÊï∞ÊçÆ
                        if (!date || !type || !projectName || isNaN(amount)) {
                            alert(`Á¨¨ ${i+1} Ë°åÊï∞ÊçÆÊ†ºÂºè‰∏çÊ≠£Á°ÆÔºåË∑≥ËøáËØ•Ë°å`);
                            hasError = true;
                            continue;
                        }
                        
                        // È™åËØÅÁ±ªÂûã
                        if (type !== 'Êî∂ÂÖ•' && type !== 'ÊîØÂá∫') {
                            alert(`Á¨¨ ${i+1} Ë°åÁ±ªÂûã‰∏çÊ≠£Á°ÆÔºåÂ∫î‰∏∫"Êî∂ÂÖ•"Êàñ"ÊîØÂá∫"ÔºåË∑≥ËøáËØ•Ë°å`);
                            hasError = true;
                            continue;
                        }
                        
                        // Êü•ÊâæÈ°πÁõÆ
                        const project = projects.find(p => p.name === projectName);
                        if (!project) {
                            alert(`Á¨¨ ${i+1} Ë°åÈ°πÁõÆ"${projectName}"‰∏çÂ≠òÂú®ÔºåË∑≥ËøáËØ•Ë°å`);
                            hasError = true;
                            continue;
                        }
                        
                        // È™åËØÅÈ°πÁõÆÁ±ªÂûãÊòØÂê¶ÂåπÈÖç
                        if ((type === 'Êî∂ÂÖ•' && project.type !== 'income') || 
                            (type === 'ÊîØÂá∫' && project.type !== 'expense')) {
                            alert(`Á¨¨ ${i+1} Ë°åÈ°πÁõÆ"${projectName}"Á±ªÂûã‰∏çÂåπÈÖçÔºåË∑≥ËøáËØ•Ë°å`);
                            hasError = true;
                            continue;
                        }
                        
                        // Ê∑ªÂä†Âà∞ÂØºÂÖ•Êï∞ÊçÆ
                        importData.push({
                            id: Date.now() + i,
                            date,
                            type: type === 'Êî∂ÂÖ•' ? 'income' : 'expense',
                            projectId: project.id,
                            projectName,
                            projectEmoji: project.emoji,
                            amount: type === 'Êî∂ÂÖ•' ? amount : -amount,
                            note
                        });
                    }
                    
                    if (importData.length > 0) {
                        // ÊòæÁ§∫È¢ÑËßà
                        showImportPreview();
                        importBtn.disabled = false;
                        
                        if (hasError) {
                            showNotification('ÈÉ®ÂàÜÊï∞ÊçÆÂØºÂÖ•Â§±Ë¥•ÔºåËØ∑Êü•ÁúãÊèêÁ§∫‰ø°ÊÅØ', 'danger');
                        } else {
                            showNotification(`ÊàêÂäüËß£Êûê ${importData.length} Êù°ËÆ∞ÂΩïÔºåÁÇπÂáª"ÂØºÂÖ•Êï∞ÊçÆ"ÊåâÈíÆÂÆåÊàêÂØºÂÖ•`, 'success');
                        }
                    } else {
                        alert('Ê≤°ÊúâÊâæÂà∞ÊúâÊïàÁöÑËÆ∞ÂΩïÊï∞ÊçÆ');
                        importBtn.disabled = true;
                        importPreview.style.display = 'none';
                    }
                } catch (error) {
                    console.error('ÂØºÂÖ•ÈîôËØØ:', error);
                    alert('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂Ê†ºÂºè');
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        function showImportPreview() {
            importPreviewBody.innerHTML = '';
            
            // Âè™ÊòæÁ§∫Ââç5Êù°ËÆ∞ÂΩï‰Ωú‰∏∫È¢ÑËßà
            const previewData = importData.slice(0, 5);
            
            previewData.forEach(record => {
                const row = importPreviewBody.insertRow();
                
                // Êó•Êúü
                const dateCell = row.insertCell(0);
                dateCell.textContent = record.date;
                
                // Á±ªÂûã
                const typeCell = row.insertCell(1);
                typeCell.textContent = record.type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫';
                typeCell.className = record.type === 'income' ? 'income' : 'expense';
                
                // È°πÁõÆ
                const projectCell = row.insertCell(2);
                projectCell.innerHTML = `<span class="emoji">${record.projectEmoji || 'üìÅ'}</span> ${record.projectName}`;
                
                // ÈáëÈ¢ù
                const amountCell = row.insertCell(3);
                amountCell.textContent = `¬•${Math.abs(record.amount).toFixed(2)}`;
                amountCell.className = record.type === 'income' ? 'income' : 'expense';
                
                // Â§áÊ≥®
                const noteCell = row.insertCell(4);
                noteCell.textContent = record.note || '-';
            });
            
            if (importData.length > 5) {
                const infoRow = importPreviewBody.insertRow();
                const infoCell = infoRow.insertCell(0);
                infoCell.colSpan = 5;
                infoCell.textContent = `... ËøòÊúâ ${importData.length - 5} Êù°ËÆ∞ÂΩï`;
                infoCell.style.textAlign = 'center';
                infoCell.style.fontStyle = 'italic';
                infoCell.style.color = '#999';
            }
            
            importPreview.style.display = 'block';
        }
        
        function importRecords() {
            if (importData.length === 0) {
                alert('Ê≤°ÊúâÂèØÂØºÂÖ•ÁöÑÊï∞ÊçÆ');
                return;
            }
            
            // Â∞ÜÂØºÂÖ•Êï∞ÊçÆÊ∑ªÂä†Âà∞ËÆ∞ÂΩï‰∏≠
            records = [...importData, ...records];
            saveData();
            
            // Êõ¥Êñ∞UI
            updateRecordsTable();
            updateTotalAmount();
            
            // ÈáçÁΩÆÂØºÂÖ•Áä∂ÊÄÅ
            importFileInput.value = '';
            importBtn.disabled = true;
            importPreview.style.display = 'none';
            importData = [];
            
            showNotification(`ÊàêÂäüÂØºÂÖ• ${importData.length} Êù°ËÆ∞ÂΩïÔºÅ`, 'success');
        }
        
        function downloadTemplate() {
            // ÂàõÂª∫Ê®°ÊùøÊï∞ÊçÆ
            const templateData = [
                ['Êó•Êúü', 'Á±ªÂûã', 'È°πÁõÆ', 'ÈáëÈ¢ù', 'Â§áÊ≥®'],
                ['2023-01-01', 'Êî∂ÂÖ•', 'Â∑•ËµÑ', '5000', '‰∏ÄÊúàÂ∑•ËµÑ'],
                ['2023-01-02', 'ÊîØÂá∫', 'È•ÆÈ£ü', '50', 'ÂçàÈ§ê'],
                ['2023-01-03', 'ÊîØÂá∫', 'Ë°£Êúç', '200', 'Êñ∞Ë°£Êúç'],
                ['2023-01-04', 'Êî∂ÂÖ•', 'ÂÖ∂‰ªñ', '100', 'Á∫¢ÂåÖ'],
                ['2023-01-05', 'ÊîØÂá∫', 'Êó•Áî®ÂìÅ', '80', 'Ê¥óÂèëÊ∞¥']
            ];
            
            // ÂàõÂª∫Â∑•‰ΩúÁ∞ø
            const ws = XLSX.utils.aoa_to_sheet(templateData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Ë¥¶Êú¨ËÆ∞ÂΩïÊ®°Êùø");
            
            // ËÆæÁΩÆÂàóÂÆΩ
            const colWidths = [
                { wch: 12 }, // Êó•Êúü
                { wch: 8 },  // Á±ªÂûã
                { wch: 12 }, // È°πÁõÆ
                { wch: 10 }, // ÈáëÈ¢ù
                { wch: 20 }  // Â§áÊ≥®
            ];
            ws['!cols'] = colWidths;
            
            // ÂØºÂá∫Êñá‰ª∂
            XLSX.writeFile(wb, "Ë¥¶Êú¨ËÆ∞ÂΩïÊ®°Êùø.xlsx");
            
            showNotification('Ê®°Êùø‰∏ãËΩΩÊàêÂäüÔºÅ', 'success');
        }

        // ÁõëÂê¨Á±ªÂûãÂèòÂåñÔºåÊõ¥Êñ∞È°πÁõÆÂàóË°®
        document.getElementById('type').addEventListener('change', updateProjectSelect);
    </script>
</body>
</html>